# Rime schema
# encoding: utf-8
# moqi_xh-18key: 墨奇辅助码 鹤拼版 - Android 18键专用
# 基于 moqi_xh-trime.schema.yaml，针对18键共键布局优化
# 采用形码引导键方案：点击[进入形码，上滑'分词

schema:
  schema_id: moqi_xh-18key
  name: MQ+XH 18键
  version: "2026-01-05"
  author:
    - gaboolic (原墨奇码)
    - Custom (18键适配)
  description: |
    墨奇辅助码 鹤拼版 - Android 18键专用
    专为18键共键布局优化，支持滑动精确输入
    形码引导键方案：点击[进入形码输入，上滑'分词
    设计文档：plans/moqi-xh-18key-design.md
  dependencies:
    - cangjie5
    - reverse_moqima
    - radical_flypy
    - stroke
    - zrlf
    - emoji
    - easy_en
    - jp_sela
    - moqi_big

# 引入基础配置
__include: moqi.yaml:/switches_engine
__include: moqi.yaml:/phrase
__include: moqi.yaml:/reverse
__include: moqi.yaml:/opencc_config
__include: moqi.yaml:/punctuator
__include: moqi.yaml:/guide
__include: moqi.yaml:/big_char_and_user_dict

# ========== 18键专用 Speller 配置 ==========
speller:
  max_code_length: 6
  auto_select: false
  auto_select_pattern: ^[a-z]+/|^[a-df-zA-DF-Z]\w{3}|^e\w{4}|;[a-z]
  # alphabet 包含大写字母用于精确输入，包含 [ 用于形码引导
  alphabet: zyxwvutsrqponmlkjihgfedcbaZYXWVUTSRQPONMLKJIHGFEDCBA[/|'
  initials: zyxwvutsrqponmlkjihgfedcbaZYXWVUTSRQPONMLKJIHGFEDCBA
  delimiter: " '"
  
  algebra:
    # ========== 辅助码处理规则 ==========
    # 保持与原版兼容，支持 [辅助码 格式
    - derive|^(.+)[[](\w)(\w)$|$1|              # 纯双拼
    - derive|^(.+)[[](\w)(\w)$|$1$2|            # 双拼+1位辅助码（无[）
    - derive|^(.+)[[](\w)(\w)$|$1[$2|           # 双拼+[+1位辅助码
    - derive|^(.+)[[](\w)(\w)$|$1$2$3|          # 双拼+2位辅助码（无[）
    - derive|^(.+)[[](\w)(\w)$|$1[$2$3|         # 双拼+[+2位辅助码
    - derive|^(.+)[[](\w)(\w)$|$1$2$3o|         # 整句单字 syffo
    - derive|^(.+)[[](\w)(\w)$|$1$2$3/|         # 整句单字 syff/
    
    # ========== 飞键规则 ==========
    - derive/^([y])j/$1f/
    - derive/^qx/qw/
    - derive/^xq/xo/
    - derive/^qq/qo/
    - derive/^ww/wi/
    - derive/^j([a-twyz])/f$1/                  # j -> f互击
    - derive/^([y])h/$1g/
    - derive/^([rsgv])c/$1n/
    
    # ========== 18键共键模糊（音码部分：声母位置） ==========
    # WE 共键
    - derive/^w([a-z])/e$1/
    - derive/^e([a-z])/w$1/
    # RT 共键
    - derive/^r([a-z])/t$1/
    - derive/^t([a-z])/r$1/
    # IO 共键
    - derive/^i([a-z])/o$1/
    - derive/^o([a-z])/i$1/
    # SD 共键
    - derive/^s([a-z])/d$1/
    - derive/^d([a-z])/s$1/
    # FG 共键
    - derive/^f([a-z])/g$1/
    - derive/^g([a-z])/f$1/
    # JK 共键
    - derive/^j([a-z])/k$1/
    - derive/^k([a-z])/j$1/
    # XC 共键
    - derive/^x([a-z])/c$1/
    - derive/^c([a-z])/x$1/
    # BN 共键
    - derive/^b([a-z])/n$1/
    - derive/^n([a-z])/b$1/
    
    # ========== 18键共键模糊（音码部分：韵母位置） ==========
    # WE 共键
    - derive/^([a-z])w$/$1e/
    - derive/^([a-z])e$/$1w/
    # RT 共键
    - derive/^([a-z])r$/$1t/
    - derive/^([a-z])t$/$1r/
    # IO 共键
    - derive/^([a-z])i$/$1o/
    - derive/^([a-z])o$/$1i/
    # SD 共键
    - derive/^([a-z])s$/$1d/
    - derive/^([a-z])d$/$1s/
    # FG 共键
    - derive/^([a-z])f$/$1g/
    - derive/^([a-z])g$/$1f/
    # JK 共键
    - derive/^([a-z])j$/$1k/
    - derive/^([a-z])k$/$1j/
    # XC 共键
    - derive/^([a-z])x$/$1c/
    - derive/^([a-z])c$/$1x/
    # BN 共键
    - derive/^([a-z])b$/$1n/
    - derive/^([a-z])n$/$1b/
    
    # ========== 18键共键模糊（形码部分：第1位） ==========
    # 形码以 [ 引导，需要对 [后的字符应用模糊
    # WE 共键
    - derive/\[w/[e/
    - derive/\[e/[w/
    # RT 共键
    - derive/\[r/[t/
    - derive/\[t/[r/
    # IO 共键
    - derive/\[i/[o/
    - derive/\[o/[i/
    # SD 共键
    - derive/\[s/[d/
    - derive/\[d/[s/
    # FG 共键
    - derive/\[f/[g/
    - derive/\[g/[f/
    # JK 共键
    - derive/\[j/[k/
    - derive/\[k/[j/
    # XC 共键
    - derive/\[x/[c/
    - derive/\[c/[x/
    # BN 共键
    - derive/\[b/[n/
    - derive/\[n/[b/
    
    # ========== 18键共键模糊（形码部分：第2位） ==========
    # WE 共键
    - derive/\[(\w)w$/[$1e/
    - derive/\[(\w)e$/[$1w/
    # RT 共键
    - derive/\[(\w)r$/[$1t/
    - derive/\[(\w)t$/[$1r/
    # IO 共键
    - derive/\[(\w)i$/[$1o/
    - derive/\[(\w)o$/[$1i/
    # SD 共键
    - derive/\[(\w)s$/[$1d/
    - derive/\[(\w)d$/[$1s/
    # FG 共键
    - derive/\[(\w)f$/[$1g/
    - derive/\[(\w)g$/[$1f/
    # JK 共键
    - derive/\[(\w)j$/[$1k/
    - derive/\[(\w)k$/[$1j/
    # XC 共键
    - derive/\[(\w)x$/[$1c/
    - derive/\[(\w)c$/[$1x/
    # BN 共键
    - derive/\[(\w)b$/[$1n/
    - derive/\[(\w)n$/[$1b/

# ========== Translator 配置 ==========
translator:
  dictionary: moqi.extended
  initial_quality: 10000
  enable_completion: false
  spelling_hints: 1
  comment_format:
    - "xform/(^|[ '])[^[]+[[]/$1/"   # 编码提示只显示辅助码部分
  enable_user_dict: true

# ========== 快捷键配置 ==========
key_binder:
  import_preset: default
  bindings:
    # 分号选2
    - { when: has_menu, accept: semicolon, send: 2 }
    # Ctrl快捷键
    - { when: composing, accept: Control+m, send: Return }
    - { when: composing, accept: Control+w, send: Control+BackSpace }
    - { when: composing, accept: Control+i, send: Shift+Right }
    - { when: composing, accept: Control+o, send: Shift+Left }
    # 开关切换
    - { when: has_menu, accept: "Control+u", toggle: big_char_set }
    - { when: has_menu, accept: "Control+p", toggle: chaifen }
    - { when: has_menu, accept: "Control+l", toggle: chaifen_all }
    - { when: has_menu, accept: "Control+e", toggle: chinese_english }
    # Tab/./上屏（保留，手机上可能通过其他方式触发）
    - { match: "[a-z]{1,3}", accept: Tab, send_sequence: "/1" }
    - { match: "[a-z]{1,3}", accept: "/", send_sequence: "/1" }
    - { match: "[a-z]{1,3}", accept: ".", send_sequence: "/1" }

# 语言模型
__include: moqi:/octagram/enable_for_sentence

# 3码出简让全
custom_phrase_3_code:
  dictionary: ""
  user_dict: custom_phrase/custom_phrase_3_code
  db_class: stabledb
  enable_sentence: false
  enable_completion: false
  initial_quality: 1

# ========== 18键精确输入配置 ==========
# 供 Lua 脚本读取
precise_input:
  # 共键对配置
  fuzzy_pairs:
    - "we"
    - "rt"
    - "io"
    - "sd"
    - "fg"
    - "jk"
    - "xc"
    - "bn"
